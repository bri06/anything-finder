<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="list-items.html">
<link rel="import" href="bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="anything-finder.html">

<dom-module id="app-shell">

  <template>
    <style>
      :host {
        display: block;
        padding: 1rem;
      }
    </style>

    <h1>Welcome to the [[topic]] search bro</h1>

    <anything-finder></anything-finder>
    <iron-ajax loading="{{loading}}"></iron-ajax>
    <template is="dom-if" if="[[loading]]">
      <paper-spinner class="load" active></paper-spinner>
    </template>
    <template is="dom-if" if="[[!loading]]">
      <list-items items="[[films]]" error="[[error]]"></list-items>
    </template>
  </template>

  <script>
    class AppShell extends Polymer.Element {

      static get is() {
        return "app-shell";
      }

      static get properties() {
        return {
          filmName: String,
          url: String,
          films: Object,
          error: String,
          loading: {
            type: Boolean
          },
          topic: {
            type: String,
            value: 'movie'
          }
        }
      }
      ready() {
        super.ready();
        this.addEventListener('searchPerform', async (e) => {
          this.filmName = e.detail.value;
          const ironAjax = this.shadowRoot.querySelector('iron-ajax');
          ironAjax.url = `https://www.omdbapi.com/?s=${this.filmName}&plot=full&apikey=e477ed6a`;
          try {
            const res = await ironAjax.generateRequest().completes;
            if (!!res.response.Search) {
              this.films = res.response.Search;
            } else {
              this.films = [];
              this.error = res.response.Error;
            }
          } catch (err) {
            console.error(err);
          }
        });
      }
    }
    customElements.define(AppShell.is, AppShell);
  </script>

</dom-module>